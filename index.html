const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const gridCount = 10;
let gridSize;

function resizeCanvas() {
  const size = Math.min(window.innerWidth*0.9, 400);
  canvas.width = size;
  canvas.height = size;
  gridSize = canvas.width / gridCount;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ðŸ”¹ Caminhos relativos para pasta assets
const headImgs = ["assets/head1.png", "assets/head2.png"];
const foodImgs = ["assets/food1.png", "assets/food2.png", "assets/food3.png"];

function loadImages(urls) {
  return urls.map(src => {
    let img = new Image();
    img.src = src;
    return img;
  });
}
const heads = loadImages(headImgs);
const foods = loadImages(foodImgs);

let snake = [{x:5, y:5}];
let snakeDir = {x:0, y:0};
let headImg = heads[Math.floor(Math.random()*heads.length)];
let food = {x:2, y:2, img: foods[Math.floor(Math.random()*foods.length)]};
let score = 0;

let highScore = localStorage.getItem("snakeHighScore") 
                ? parseInt(localStorage.getItem("snakeHighScore")) 
                : 0;
document.getElementById("highscore").textContent = "Recorde: " + highScore;

function placeFood() {
  let x, y;
  do {
    x = Math.floor(Math.random() * gridCount);
    y = Math.floor(Math.random() * gridCount);
  } while (snake.some(s => s.x === x && s.y === y));
  food = {x, y, img: foods[Math.floor(Math.random()*foods.length)]};
}

function update() {
  if (snakeDir.x === 0 && snakeDir.y === 0) { draw(); return; }

  let head = {x: snake[0].x + snakeDir.x, y: snake[0].y + snakeDir.y};
  head.x = (head.x + gridCount) % gridCount;
  head.y = (head.y + gridCount) % gridCount;

  if (snake.some(s => s.x === head.x && s.y === head.y)) { resetGame(); return; }

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score++; 
    document.getElementById("score").textContent = "PontuaÃ§Ã£o: " + score;

    if (score > highScore) {
      highScore = score;
      localStorage.setItem("snakeHighScore", highScore);
      document.getElementById("highscore").textContent = "Recorde: " + highScore;
    }

    placeFood();
    if (Math.random() < 0.3) {
      headImg = heads[Math.floor(Math.random()*heads.length)];
    }
  } else {
    snake.pop();
  }

  draw();
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(food.img, food.x*gridSize, food.y*gridSize, gridSize, gridSize);

  for (let i=1; i<snake.length; i++) {
    let seg = snake[i];
    ctx.fillStyle = "#00ff99";
    ctx.fillRect(seg.x*gridSize, seg.y*gridSize, gridSize, gridSize);
  }
  ctx.drawImage(headImg, snake[0].x*gridSize, snake[0].y*gridSize, gridSize, gridSize);
}

function resetGame() {
  snake = [{x:5, y:5}];
  snakeDir = {x:0, y:0};
  score = 0; 
  document.getElementById("score").textContent = "PontuaÃ§Ã£o: " + score;
  headImg = heads[Math.floor(Math.random()*heads.length)];
  placeFood();
}

window.addEventListener('keydown', e => {
  switch(e.key) {
    case 'ArrowUp': if(snakeDir.y!==1) snakeDir={x:0,y:-1}; break;
    case 'ArrowDown': if(snakeDir.y!==-1) snakeDir={x:0,y:1}; break;
    case 'ArrowLeft': if(snakeDir.x!==1) snakeDir={x:-1,y:0}; break;
    case 'ArrowRight': if(snakeDir.x!==-1) snakeDir={x:1,y:0}; break;
  }
});

document.getElementById('up').addEventListener('click', () => { if(snakeDir.y!==1) snakeDir={x:0,y:-1}; });
document.getElementById('down').addEventListener('click', () => { if(snakeDir.y!==-1) snakeDir={x:0,y:1}; });
document.getElementById('left').addEventListener('click', () => { if(snakeDir.x!==1) snakeDir={x:-1,y:0}; });
document.getElementById('right').addEventListener('click', () => { if(snakeDir.x!==-1) snakeDir={x:1,y:0}; });

resetGame();
setInterval(update, 200);
